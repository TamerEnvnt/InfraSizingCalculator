@namespace InfraSizingCalculator.Components.Results
@using InfraSizingCalculator.Models.Growth
@using InfraSizingCalculator.Components.Configuration

<!-- Growth Planning Dashboard - Compact Design -->
<div class="growth-dashboard compact">
    <!-- Inline Settings Bar -->
    <div class="settings-bar-compact">
        <div class="settings-inline">
            <div class="setting-inline">
                <span class="setting-label">Period</span>
                <select @bind="Settings.ProjectionYears" @bind:after="OnSettingsChanged">
                    <option value="1">1 Year</option>
                    <option value="3">3 Years</option>
                    <option value="5">5 Years</option>
                </select>
            </div>
            <div class="setting-inline">
                <span class="setting-label">Growth</span>
                <div class="rate-input-sm">
                    <input type="number" min="0" max="200" @bind="Settings.AnnualGrowthRate" @bind:after="OnSettingsChanged" />
                    <span>%</span>
                </div>
            </div>
            <div class="setting-inline">
                <span class="setting-label">Pattern</span>
                <select @bind="Settings.Pattern" @bind:after="OnSettingsChanged">
                    <option value="@GrowthPattern.Linear">Linear</option>
                    <option value="@GrowthPattern.Exponential">Exponential</option>
                    <option value="@GrowthPattern.SCurve">S-Curve</option>
                </select>
            </div>
            <label class="toggle-sm">
                <input type="checkbox" @bind="Settings.IncludeCostProjections" @bind:after="OnSettingsChanged" />
                <span>Cost</span>
            </label>
        </div>
        <button class="btn-calc-sm" @onclick="Calculate" disabled="@IsCalculating">
            @if (IsCalculating) { <span class="spinner-sm"></span> }
            <span>Calculate</span>
        </button>
    </div>

    @if (Projection != null)
    {
        <!-- Compact Hero Strip -->
        <div class="hero-strip">
            <div class="hero-item">
                <span class="hero-icon-sm">üì±</span>
                <div class="hero-data">
                    <span class="hero-label-sm">Apps</span>
                    <span class="hero-value-sm">@Projection.Baseline.ProjectedApps ‚Üí @GetFinalPoint().ProjectedApps</span>
                </div>
                <span class="hero-badge positive">+@Projection.Summary.PercentageAppGrowth.ToString("F0")%</span>
            </div>
            <div class="hero-divider"></div>
            <div class="hero-item">
                <span class="hero-icon-sm">üñ•Ô∏è</span>
                <div class="hero-data">
                    <span class="hero-label-sm">Nodes</span>
                    <span class="hero-value-sm">@Projection.Baseline.ProjectedNodes ‚Üí @GetFinalPoint().ProjectedNodes</span>
                </div>
                <span class="hero-badge positive">+@Projection.Summary.TotalNodeGrowth</span>
            </div>
            @if (Settings.IncludeCostProjections)
            {
                <div class="hero-divider"></div>
                <div class="hero-item">
                    <span class="hero-icon-sm">üí∞</span>
                    <div class="hero-data">
                        <span class="hero-label-sm">Investment</span>
                        <span class="hero-value-sm large">@FormatCurrency(Projection.Summary.TotalCostOverPeriod)</span>
                    </div>
                    <span class="hero-sub">@Projection.Settings.ProjectionYears yr</span>
                </div>
                <div class="hero-divider"></div>
                <div class="hero-item">
                    <span class="hero-icon-sm">üìä</span>
                    <div class="hero-data">
                        <span class="hero-label-sm">Avg/Month</span>
                        <span class="hero-value-sm large">@FormatCurrency(Projection.Summary.AverageYearlyCost / 12)</span>
                    </div>
                </div>
            }
        </div>

        <!-- Compact Tab Bar -->
        <div class="tab-bar-compact">
            <button class="tab-sm @(activeTab == "resources" ? "active" : "")" @onclick='() => activeTab = "resources"'>
                üì¶ Resources
            </button>
            @if (Settings.IncludeCostProjections)
            {
                <button class="tab-sm @(activeTab == "cost" ? "active" : "")" @onclick='() => activeTab = "cost"'>
                    üíµ Cost
                </button>
            }
            <button class="tab-sm @(activeTab == "timeline" ? "active" : "")" @onclick='() => activeTab = "timeline"'>
                üìÖ Timeline
            </button>
        </div>

        <!-- Resources Tab - Two Column Layout -->
        @if (activeTab == "resources")
        {
            <div class="resources-grid">
                <!-- Left: Year Cards -->
                <div class="timeline-column">
                    <div class="section-header-sm">
                        <span class="section-title-sm">Growth Timeline</span>
                    </div>
                    <div class="year-cards-compact">
                        @foreach (var point in GetAllPoints())
                        {
                            var isBaseline = point.Year == 0;
                            var maxNodes = GetMaxNodes();
                            var progressPct = maxNodes > 0 ? (point.ProjectedNodes * 100.0 / maxNodes) : 0;

                            <div class="year-card-sm @(isBaseline ? "baseline" : "")">
                                <div class="yc-header">
                                    <span class="yc-label">@point.Label</span>
                                    @if (!isBaseline)
                                    {
                                        <span class="yc-badge">+@point.GrowthFromPrevious.ToString("F0")%</span>
                                    }
                                </div>
                                <div class="yc-main">
                                    <span class="yc-value">@point.ProjectedNodes</span>
                                    <span class="yc-unit">nodes</span>
                                    <div class="yc-progress">
                                        <div class="yc-fill @(isBaseline ? "baseline" : "")" style="width: @progressPct%"></div>
                                    </div>
                                </div>
                                <div class="yc-footer">
                                    <span>‚ö°@point.ProjectedCpu</span>
                                    <span>üíæ@point.ProjectedRamGB.ToString("N0")GB</span>
                                </div>
                            </div>
                        }
                    </div>
                </div>

                <!-- Right: Resource Table -->
                <div class="table-column">
                    <div class="section-header-sm">
                        <span class="section-title-sm">Resource Details</span>
                    </div>
                    <div class="table-wrapper-compact">
                        <table class="data-table-sm">
                            <thead>
                                <tr>
                                    <th>Period</th>
                                    <th>Apps</th>
                                    <th>Nodes</th>
                                    <th>vCPU</th>
                                    <th>RAM</th>
                                    <th>Storage</th>
                                    @if (Settings.IncludeCostProjections)
                                    {
                                        <th>Monthly</th>
                                    }
                                    <th>Growth</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var point in GetAllPoints())
                                {
                                    var isBaseline = point.Year == 0;
                                    <tr class="@(isBaseline ? "baseline-row" : "")">
                                        <td class="period-cell-sm">
                                            <span class="dot-sm @(isBaseline ? "baseline" : "")"></span>
                                            @point.Label
                                        </td>
                                        <td>@point.ProjectedApps</td>
                                        <td class="highlight">@point.ProjectedNodes</td>
                                        <td>@point.ProjectedCpu</td>
                                        <td>@point.ProjectedRamGB.ToString("N0")</td>
                                        <td>@point.ProjectedStorageGB.ToString("N0")</td>
                                        @if (Settings.IncludeCostProjections)
                                        {
                                            <td>@FormatCurrency(point.ProjectedMonthlyCost)</td>
                                        }
                                        <td>
                                            @if (isBaseline)
                                            {
                                                <span class="tag-sm baseline">Base</span>
                                            }
                                            else
                                            {
                                                <span class="tag-sm growth">+@point.CumulativeGrowth.ToString("F0")%</span>
                                            }
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        }

        <!-- Cost Tab - Compact -->
        @if (activeTab == "cost" && Settings.IncludeCostProjections)
        {
            <div class="cost-grid">
                <!-- Left: Bar Chart -->
                <div class="chart-column">
                    <div class="section-header-sm">
                        <span class="section-title-sm">Cost Projection</span>
                    </div>
                    <div class="cost-chart-compact">
                        @foreach (var point in GetAllPoints())
                        {
                            var isBaseline = point.Year == 0;
                            var maxCost = GetMaxYearlyCost();
                            var heightPct = maxCost > 0 ? ((double)point.ProjectedYearlyCost * 100.0 / (double)maxCost) : 0;

                            <div class="bar-group-sm @(isBaseline ? "baseline" : "")">
                                <div class="bar-wrap">
                                    <div class="bar-sm" style="height: @heightPct%">
                                        <span class="bar-val">@FormatCurrencyShort(point.ProjectedYearlyCost)</span>
                                    </div>
                                </div>
                                <span class="bar-lbl">@point.Label</span>
                                @if (!isBaseline && point.GrowthFromPrevious > 0)
                                {
                                    <span class="bar-growth">+@point.GrowthFromPrevious.ToString("F0")%</span>
                                }
                            </div>
                        }
                    </div>
                </div>

                <!-- Right: Cost Summary -->
                <div class="summary-column">
                    <div class="section-header-sm">
                        <span class="section-title-sm">Cost Summary</span>
                    </div>
                    <div class="cost-cards-compact">
                        <div class="cost-card-sm total">
                            <span class="cc-icon">üíé</span>
                            <div class="cc-data">
                                <span class="cc-label">Total</span>
                                <span class="cc-value">@FormatCurrency(Projection.Summary.TotalCostOverPeriod)</span>
                            </div>
                        </div>
                        <div class="cost-card-sm increase">
                            <span class="cc-icon">üìà</span>
                            <div class="cc-data">
                                <span class="cc-label">Growth</span>
                                <span class="cc-value">+@Projection.Summary.PercentageCostIncrease.ToString("F0")%</span>
                            </div>
                        </div>
                        <div class="cost-card-sm average">
                            <span class="cc-icon">üìä</span>
                            <div class="cc-data">
                                <span class="cc-label">Avg/Year</span>
                                <span class="cc-value">@FormatCurrency(Projection.Summary.AverageYearlyCost)</span>
                            </div>
                        </div>
                        <div class="cost-card-sm monthly">
                            <span class="cc-icon">üìÖ</span>
                            <div class="cc-data">
                                <span class="cc-label">Final/Mo</span>
                                <span class="cc-value">@FormatCurrency(GetFinalPoint().ProjectedMonthlyCost)</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        }

        <!-- Timeline Tab - Compact -->
        @if (activeTab == "timeline")
        {
            <div class="timeline-content-compact">
                <!-- Compact Visual Timeline -->
                <div class="timeline-visual-compact">
                    <div class="tl-track"></div>
                    <div class="tl-nodes">
                        <div class="tl-node baseline">
                            <div class="tl-dot"></div>
                            <span class="tl-label">Now</span>
                        </div>
                        @foreach (var year in Enumerable.Range(1, Settings.ProjectionYears))
                        {
                            var yearWarnings = Projection.Warnings.Where(w => w.YearTriggered == year).ToList();
                            var yearRecs = Projection.Recommendations.Where(r => r.RecommendedYear == year).ToList();
                            var hasWarning = yearWarnings.Any(w => w.Severity == Models.Growth.WarningSeverity.Warning);
                            var hasCritical = yearWarnings.Any(w => w.Severity == Models.Growth.WarningSeverity.Critical);
                            var hasEvents = yearWarnings.Any() || yearRecs.Any();

                            <div class="tl-node @(hasCritical ? "critical" : hasWarning ? "warning" : hasEvents ? "event" : "")">
                                <div class="tl-dot">
                                    @if (hasEvents) { <span>@(yearWarnings.Count + yearRecs.Count)</span> }
                                </div>
                                <span class="tl-label">Y@(year)</span>
                            </div>
                        }
                    </div>
                </div>

                <!-- Warnings & Recommendations Grid -->
                <div class="alerts-grid">
                    @if (Projection.Warnings.Any() && Settings.ShowClusterLimitWarnings)
                    {
                        <div class="alerts-section warnings">
                            <div class="alerts-header">
                                <span>‚ö†Ô∏è Warnings</span>
                                <span class="alerts-count">@Projection.Summary.WarningCount</span>
                            </div>
                            <div class="alerts-list">
                                @foreach (var warning in Projection.Warnings.Take(3).OrderBy(w => w.YearTriggered))
                                {
                                    <div class="alert-item @warning.Severity.ToString().ToLower()">
                                        <span class="alert-icon">@GetWarningIcon(warning.Type)</span>
                                        <div class="alert-content">
                                            <span class="alert-title">@warning.ResourceType</span>
                                            <span class="alert-meta">Y@warning.YearTriggered ‚Ä¢ @warning.PercentageOfLimit.ToString("F0")%</span>
                                        </div>
                                    </div>
                                }
                                @if (Projection.Warnings.Count > 3)
                                {
                                    <div class="more-link">+@(Projection.Warnings.Count - 3) more</div>
                                }
                            </div>
                        </div>
                    }

                    @if (Projection.Recommendations.Any())
                    {
                        <div class="alerts-section recommendations">
                            <div class="alerts-header">
                                <span>üí° Actions</span>
                                <span class="alerts-count">@Projection.Recommendations.Count</span>
                            </div>
                            <div class="alerts-list">
                                @foreach (var rec in Projection.Recommendations.Take(3).OrderBy(r => r.Priority))
                                {
                                    <div class="alert-item">
                                        <span class="alert-icon">@rec.Icon</span>
                                        <div class="alert-content">
                                            <span class="alert-title">@rec.Title</span>
                                            <span class="alert-meta">Priority @rec.Priority@(rec.RecommendedYear > 0 ? $" ‚Ä¢ Y{rec.RecommendedYear}" : "")</span>
                                        </div>
                                    </div>
                                }
                                @if (Projection.Recommendations.Count > 3)
                                {
                                    <div class="more-link">+@(Projection.Recommendations.Count - 3) more</div>
                                }
                            </div>
                        </div>
                    }

                    @if (!Projection.Warnings.Any() && !Projection.Recommendations.Any())
                    {
                        <div class="all-clear-compact">
                            <span>‚úÖ</span>
                            <span>All Clear - No capacity issues projected</span>
                        </div>
                    }
                </div>
            </div>
        }
    }
    else
    {
        <div class="empty-state-sm">
            <span>üìä</span>
            <span>Configure settings and click Calculate to see growth projections</span>
        </div>
    }
</div>

@code {
    [Parameter] public GrowthSettings Settings { get; set; } = new();
    [Parameter] public GrowthProjection? Projection { get; set; }
    [Parameter] public EventCallback<GrowthSettings> OnCalculate { get; set; }
    [Parameter] public EventCallback<GrowthSettings> SettingsChanged { get; set; }

    private bool IsCalculating { get; set; }
    private string activeTab = "resources";

    private async Task OnSettingsChanged()
    {
        await SettingsChanged.InvokeAsync(Settings);
    }

    private async Task Calculate()
    {
        IsCalculating = true;
        try
        {
            await OnCalculate.InvokeAsync(Settings);
        }
        finally
        {
            IsCalculating = false;
        }
    }

    private List<ProjectionPoint> GetAllPoints()
    {
        if (Projection == null) return new List<ProjectionPoint>();
        var points = new List<ProjectionPoint> { Projection.Baseline };
        points.AddRange(Projection.Points);
        return points;
    }

    private ProjectionPoint GetFinalPoint()
    {
        if (Projection == null || !Projection.Points.Any())
            return Projection?.Baseline ?? new ProjectionPoint();
        return Projection.Points.Last();
    }

    private int GetMaxNodes() => GetAllPoints().Max(p => p.ProjectedNodes);
    private decimal GetMaxYearlyCost() => GetAllPoints().Max(p => p.ProjectedYearlyCost);

    private string FormatCurrency(decimal value)
    {
        if (value >= 1_000_000) return $"${value / 1_000_000:F2}M";
        if (value >= 1_000) return $"${value / 1_000:F1}K";
        return $"${value:F0}";
    }

    private string FormatCurrencyShort(decimal value)
    {
        if (value >= 1_000_000) return $"${value / 1_000_000:F1}M";
        if (value >= 1_000) return $"${value / 1_000:F0}K";
        return $"${value:F0}";
    }

    private string GetWarningIcon(WarningType type) => type switch
    {
        WarningType.NodeLimit => "üñ•Ô∏è",
        WarningType.PodLimit => "üì¶",
        WarningType.CpuCapacity => "‚ö°",
        WarningType.MemoryCapacity => "üíæ",
        WarningType.StorageCapacity => "üíø",
        WarningType.CostThreshold => "üí∞",
        _ => "‚ö†Ô∏è"
    };
}

<style>
    /* ===== COMPACT GROWTH DASHBOARD ===== */
    .growth-dashboard.compact {
        display: flex;
        flex-direction: column;
        gap: 10px;
    }

    /* Compact Settings Bar */
    .settings-bar-compact {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 12px;
        padding: 8px 12px;
        background: var(--bg-secondary);
        border: 1px solid var(--border-color);
        border-radius: 8px;
    }

    .settings-inline {
        display: flex;
        align-items: center;
        gap: 12px;
        flex-wrap: wrap;
    }

    .setting-inline {
        display: flex;
        align-items: center;
        gap: 6px;
    }

    .setting-label {
        font-size: 0.7rem;
        color: var(--text-secondary);
        text-transform: uppercase;
    }

    .setting-inline select {
        padding: 4px 8px;
        border-radius: 4px;
        border: 1px solid var(--border-color);
        background: var(--bg-tertiary);
        color: var(--text-primary);
        font-size: 0.8rem;
    }

    .rate-input-sm {
        display: flex;
        align-items: center;
        gap: 2px;
        padding: 4px 6px;
        background: var(--bg-tertiary);
        border: 1px solid var(--border-color);
        border-radius: 4px;
    }

    .rate-input-sm input {
        width: 36px;
        border: none;
        background: transparent;
        color: var(--text-primary);
        font-size: 0.8rem;
        font-weight: 600;
        text-align: right;
    }

    .rate-input-sm span {
        color: var(--text-secondary);
        font-size: 0.75rem;
    }

    .toggle-sm {
        display: flex;
        align-items: center;
        gap: 4px;
        cursor: pointer;
        font-size: 0.75rem;
        color: var(--text-primary);
    }

    .toggle-sm input { accent-color: var(--accent-blue); }

    .btn-calc-sm {
        display: flex;
        align-items: center;
        gap: 6px;
        padding: 6px 14px;
        background: linear-gradient(135deg, #3b82f6, #2563eb);
        color: white;
        border: none;
        border-radius: 6px;
        font-size: 0.8rem;
        font-weight: 600;
        cursor: pointer;
    }

    .btn-calc-sm:hover:not(:disabled) { box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3); }
    .btn-calc-sm:disabled { opacity: 0.6; cursor: not-allowed; }

    .spinner-sm {
        width: 12px;
        height: 12px;
        border: 2px solid rgba(255,255,255,0.3);
        border-top-color: white;
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
    }

    @@keyframes spin { to { transform: rotate(360deg); } }

    /* Hero Strip */
    .hero-strip {
        display: flex;
        align-items: center;
        gap: 16px;
        padding: 10px 14px;
        background: var(--bg-secondary);
        border: 1px solid var(--border-color);
        border-radius: 8px;
        flex-wrap: wrap;
    }

    .hero-item {
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .hero-icon-sm { font-size: 1.1rem; }

    .hero-data {
        display: flex;
        flex-direction: column;
        gap: 0;
    }

    .hero-label-sm {
        font-size: 0.65rem;
        color: var(--text-secondary);
        text-transform: uppercase;
    }

    .hero-value-sm {
        font-size: 0.85rem;
        font-weight: 600;
        color: var(--text-primary);
    }

    .hero-value-sm.large {
        font-size: 1rem;
        color: #10b981;
    }

    .hero-badge {
        font-size: 0.7rem;
        padding: 2px 6px;
        border-radius: 4px;
        font-weight: 600;
    }

    .hero-badge.positive {
        background: rgba(16, 185, 129, 0.15);
        color: #10b981;
    }

    .hero-sub {
        font-size: 0.65rem;
        color: var(--text-muted);
    }

    .hero-divider {
        width: 1px;
        height: 28px;
        background: var(--border-color);
    }

    /* Compact Tab Bar */
    .tab-bar-compact {
        display: flex;
        gap: 4px;
        padding: 4px;
        background: var(--bg-secondary);
        border-radius: 6px;
        border: 1px solid var(--border-color);
        width: fit-content;
    }

    .tab-sm {
        padding: 6px 12px;
        border: none;
        background: transparent;
        border-radius: 4px;
        cursor: pointer;
        color: var(--text-secondary);
        font-size: 0.75rem;
        font-weight: 500;
    }

    .tab-sm:hover { background: var(--bg-tertiary); color: var(--text-primary); }
    .tab-sm.active { background: linear-gradient(135deg, #3b82f6, #2563eb); color: white; }

    /* Resources Grid - Two Columns */
    .resources-grid {
        display: grid;
        grid-template-columns: 280px 1fr;
        gap: 12px;
    }

    .timeline-column, .table-column {
        background: var(--bg-secondary);
        border: 1px solid var(--border-color);
        border-radius: 8px;
        padding: 10px;
    }

    .section-header-sm {
        margin-bottom: 8px;
    }

    .section-title-sm {
        font-size: 0.75rem;
        font-weight: 600;
        color: var(--text-secondary);
        text-transform: uppercase;
    }

    /* Compact Year Cards */
    .year-cards-compact {
        display: flex;
        flex-direction: column;
        gap: 6px;
    }

    .year-card-sm {
        background: var(--bg-tertiary);
        border-radius: 6px;
        padding: 8px 10px;
        border: 1px solid var(--border-color);
    }

    .year-card-sm.baseline { border-color: #3b82f6; }

    .yc-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 4px;
    }

    .yc-label {
        font-size: 0.75rem;
        font-weight: 600;
        color: var(--text-primary);
    }

    .yc-badge {
        font-size: 0.6rem;
        color: #10b981;
        background: rgba(16, 185, 129, 0.1);
        padding: 1px 5px;
        border-radius: 3px;
        font-weight: 600;
    }

    .yc-main {
        display: flex;
        align-items: baseline;
        gap: 4px;
        flex-wrap: wrap;
    }

    .yc-value {
        font-size: 1.1rem;
        font-weight: 700;
        color: var(--text-primary);
    }

    .yc-unit {
        font-size: 0.65rem;
        color: var(--text-secondary);
    }

    .yc-progress {
        flex: 1;
        min-width: 40px;
        height: 4px;
        background: var(--border-color);
        border-radius: 2px;
        margin-left: 8px;
    }

    .yc-fill {
        height: 100%;
        background: linear-gradient(90deg, #8b5cf6, #a78bfa);
        border-radius: 2px;
    }

    .yc-fill.baseline { background: linear-gradient(90deg, #3b82f6, #60a5fa); }

    .yc-footer {
        display: flex;
        gap: 8px;
        margin-top: 4px;
        font-size: 0.65rem;
        color: var(--text-muted);
    }

    /* Compact Data Table */
    .table-wrapper-compact { overflow-x: auto; }

    .data-table-sm {
        width: 100%;
        border-collapse: collapse;
        font-size: 0.75rem;
    }

    .data-table-sm th {
        padding: 6px 8px;
        background: var(--bg-tertiary);
        color: var(--text-secondary);
        font-weight: 600;
        text-transform: uppercase;
        font-size: 0.6rem;
        text-align: center;
        border-bottom: 1px solid var(--border-color);
    }

    .data-table-sm th:first-child { text-align: left; }

    .data-table-sm td {
        padding: 6px 8px;
        border-bottom: 1px solid var(--border-color);
        color: var(--text-primary);
        text-align: center;
    }

    .data-table-sm tr:hover td { background: var(--bg-tertiary); }

    .period-cell-sm {
        display: flex;
        align-items: center;
        gap: 6px;
        text-align: left !important;
    }

    .dot-sm {
        width: 6px;
        height: 6px;
        border-radius: 50%;
        background: var(--accent-blue);
    }

    .dot-sm.baseline { background: #10b981; }

    .highlight { color: var(--accent-blue) !important; font-weight: 600; }
    .baseline-row { background: rgba(16, 185, 129, 0.05); }

    .tag-sm {
        font-size: 0.6rem;
        padding: 2px 5px;
        border-radius: 3px;
        font-weight: 600;
    }

    .tag-sm.baseline { background: rgba(16, 185, 129, 0.15); color: #10b981; }
    .tag-sm.growth { background: rgba(59, 130, 246, 0.15); color: #3b82f6; }

    /* Cost Grid - Two Columns */
    .cost-grid {
        display: grid;
        grid-template-columns: 1fr 280px;
        gap: 12px;
    }

    .chart-column, .summary-column {
        background: var(--bg-secondary);
        border: 1px solid var(--border-color);
        border-radius: 8px;
        padding: 10px;
    }

    /* Compact Cost Chart */
    .cost-chart-compact {
        display: flex;
        gap: 8px;
        height: 140px;
        padding: 10px 0;
        align-items: flex-end;
    }

    .bar-group-sm {
        flex: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        height: 100%;
    }

    .bar-wrap {
        flex: 1;
        width: 100%;
        display: flex;
        align-items: flex-end;
        justify-content: center;
    }

    .bar-sm {
        width: 70%;
        max-width: 50px;
        min-height: 20px;
        background: linear-gradient(to top, #10b981, #34d399);
        border-radius: 4px 4px 0 0;
        display: flex;
        align-items: flex-start;
        justify-content: center;
        padding-top: 4px;
    }

    .bar-group-sm.baseline .bar-sm { background: linear-gradient(to top, #3b82f6, #60a5fa); }

    .bar-val {
        font-size: 0.6rem;
        font-weight: 700;
        color: white;
        text-shadow: 0 1px 2px rgba(0,0,0,0.3);
    }

    .bar-lbl {
        font-size: 0.7rem;
        font-weight: 600;
        color: var(--text-primary);
        margin-top: 4px;
    }

    .bar-growth {
        font-size: 0.55rem;
        color: #10b981;
    }

    /* Compact Cost Cards */
    .cost-cards-compact {
        display: flex;
        flex-direction: column;
        gap: 6px;
    }

    .cost-card-sm {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 8px 10px;
        background: var(--bg-tertiary);
        border-radius: 6px;
        border-left: 3px solid var(--border-color);
    }

    .cost-card-sm.total { border-left-color: #8b5cf6; }
    .cost-card-sm.increase { border-left-color: #ef4444; }
    .cost-card-sm.average { border-left-color: #f59e0b; }
    .cost-card-sm.monthly { border-left-color: #10b981; }

    .cc-icon { font-size: 1rem; }

    .cc-data { display: flex; flex-direction: column; }

    .cc-label {
        font-size: 0.6rem;
        color: var(--text-secondary);
        text-transform: uppercase;
    }

    .cc-value {
        font-size: 0.95rem;
        font-weight: 700;
        color: var(--text-primary);
    }

    /* Timeline Tab - Compact */
    .timeline-content-compact {
        display: flex;
        flex-direction: column;
        gap: 12px;
    }

    .timeline-visual-compact {
        position: relative;
        padding: 16px 10px;
        background: var(--bg-secondary);
        border: 1px solid var(--border-color);
        border-radius: 8px;
    }

    .tl-track {
        position: absolute;
        top: 50%;
        left: 40px;
        right: 40px;
        height: 3px;
        background: var(--border-color);
        border-radius: 2px;
        transform: translateY(-50%);
    }

    .tl-nodes {
        display: flex;
        justify-content: space-between;
        position: relative;
    }

    .tl-node {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 4px;
        z-index: 1;
    }

    .tl-dot {
        width: 24px;
        height: 24px;
        border-radius: 50%;
        background: var(--bg-tertiary);
        border: 2px solid var(--border-color);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.6rem;
        font-weight: 700;
    }

    .tl-node.baseline .tl-dot { border-color: #3b82f6; background: rgba(59, 130, 246, 0.1); }
    .tl-node.event .tl-dot { border-color: #8b5cf6; background: rgba(139, 92, 246, 0.1); }
    .tl-node.warning .tl-dot { border-color: #f59e0b; background: rgba(245, 158, 11, 0.15); }
    .tl-node.critical .tl-dot { border-color: #ef4444; background: rgba(239, 68, 68, 0.15); }

    .tl-label {
        font-size: 0.7rem;
        font-weight: 600;
        color: var(--text-primary);
    }

    /* Alerts Grid */
    .alerts-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 12px;
    }

    .alerts-section {
        background: var(--bg-secondary);
        border: 1px solid var(--border-color);
        border-radius: 8px;
        padding: 10px;
    }

    .alerts-section.warnings { border-left: 3px solid #f59e0b; }
    .alerts-section.recommendations { border-left: 3px solid #3b82f6; }

    .alerts-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 8px;
        font-size: 0.8rem;
        font-weight: 600;
    }

    .alerts-count {
        background: var(--bg-tertiary);
        padding: 2px 6px;
        border-radius: 4px;
        font-size: 0.7rem;
    }

    .alerts-list {
        display: flex;
        flex-direction: column;
        gap: 6px;
    }

    .alert-item {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 6px 8px;
        background: var(--bg-tertiary);
        border-radius: 4px;
    }

    .alert-item.warning { border-left: 2px solid #f59e0b; }
    .alert-item.critical { border-left: 2px solid #ef4444; }

    .alert-icon { font-size: 0.9rem; }

    .alert-content { flex: 1; }

    .alert-title {
        display: block;
        font-size: 0.75rem;
        font-weight: 600;
        color: var(--text-primary);
    }

    .alert-meta {
        font-size: 0.65rem;
        color: var(--text-muted);
    }

    .more-link {
        font-size: 0.7rem;
        color: var(--accent-blue);
        text-align: center;
        padding: 4px;
    }

    .all-clear-compact {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        padding: 16px;
        background: rgba(16, 185, 129, 0.05);
        border: 1px solid rgba(16, 185, 129, 0.3);
        border-radius: 8px;
        font-size: 0.85rem;
        color: #10b981;
        grid-column: 1 / -1;
    }

    /* Empty State */
    .empty-state-sm {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        padding: 30px;
        background: var(--bg-secondary);
        border: 1px solid var(--border-color);
        border-radius: 8px;
        color: var(--text-secondary);
        font-size: 0.85rem;
    }

    /* Responsive */
    @@media (max-width: 900px) {
        .resources-grid { grid-template-columns: 1fr; }
        .cost-grid { grid-template-columns: 1fr; }
        .hero-strip { justify-content: center; }
        .hero-divider { display: none; }
    }

    @@media (max-width: 600px) {
        .settings-bar-compact { flex-direction: column; align-items: stretch; }
        .btn-calc-sm { width: 100%; justify-content: center; }
        .year-cards-compact { flex-direction: row; flex-wrap: wrap; }
        .year-card-sm { flex: 1; min-width: 120px; }
    }

    /* Light theme */
    [data-theme="light"] .settings-bar-compact,
    [data-theme="light"] .hero-strip,
    [data-theme="light"] .tab-bar-compact,
    [data-theme="light"] .timeline-column,
    [data-theme="light"] .table-column,
    [data-theme="light"] .chart-column,
    [data-theme="light"] .summary-column,
    [data-theme="light"] .timeline-visual-compact,
    [data-theme="light"] .alerts-section,
    [data-theme="light"] .empty-state-sm {
        background: #fff;
    }

    [data-theme="light"] .year-card-sm,
    [data-theme="light"] .cost-card-sm,
    [data-theme="light"] .alert-item,
    [data-theme="light"] .tl-dot,
    [data-theme="light"] .data-table-sm th {
        background: #f8f9fa;
    }
</style>
