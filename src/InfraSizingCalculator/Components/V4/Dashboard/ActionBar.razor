@*
    ActionBar.razor - Fixed bottom action bar

    Features:
    - 64px fixed height at bottom of viewport
    - Primary actions: Save, Export, Compare
    - Secondary actions on left (reset, help)
    - Different buttons shown for Guest vs Auth users
*@

<div class="action-bar" data-testid="action-bar">
    <div class="action-bar-left">
        @if (ShowReset)
        {
            <button class="action-btn secondary" @onclick="HandleReset" data-testid="btn-reset">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/>
                    <path d="M3 3v5h5"/>
                </svg>
                <span class="btn-text">Reset</span>
            </button>
        }

        @if (ShowHelp)
        {
            <button class="action-btn secondary" @onclick="HandleHelp" data-testid="btn-help">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"/>
                    <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/>
                    <line x1="12" y1="17" x2="12.01" y2="17"/>
                </svg>
                <span class="btn-text">Help</span>
            </button>
        }
    </div>

    <div class="action-bar-right">
        @if (IsGuest)
        {
            @* Guest user actions *@
            <button class="action-btn secondary" @onclick="HandleExport" data-testid="btn-export-guest">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                    <polyline points="7 10 12 15 17 10"/>
                    <line x1="12" y1="15" x2="12" y2="3"/>
                </svg>
                <span class="btn-text">Export (PDF Only)</span>
            </button>

            <button class="action-btn primary" @onclick="HandleSignUp" data-testid="btn-signup-cta">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                    <circle cx="8.5" cy="7" r="4"/>
                    <line x1="20" y1="8" x2="20" y2="14"/>
                    <line x1="23" y1="11" x2="17" y2="11"/>
                </svg>
                <span class="btn-text">Sign Up to Save & Export All</span>
            </button>
        }
        else
        {
            @* Authenticated user actions *@
            <button class="action-btn secondary" @onclick="HandleCompare" data-testid="btn-compare" disabled="@(!CanCompare)">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="20" x2="18" y2="10"/>
                    <line x1="12" y1="20" x2="12" y2="4"/>
                    <line x1="6" y1="20" x2="6" y2="14"/>
                </svg>
                <span class="btn-text">Compare</span>
            </button>

            <button class="action-btn secondary" @onclick="HandleExport" data-testid="btn-export">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                    <polyline points="7 10 12 15 17 10"/>
                    <line x1="12" y1="15" x2="12" y2="3"/>
                </svg>
                <span class="btn-text">Export</span>
            </button>

            <button class="action-btn primary" @onclick="HandleSave" data-testid="btn-save" disabled="@IsSaving">
                @if (IsSaving)
                {
                    <span class="spinner"></span>
                    <span class="btn-text">Saving...</span>
                }
                else
                {
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
                        <polyline points="17 21 17 13 7 13 7 21"/>
                        <polyline points="7 3 7 8 15 8"/>
                    </svg>
                    <span class="btn-text">@(HasUnsavedChanges ? "Save *" : "Save")</span>
                }
            </button>
        }
    </div>
</div>

@code {
    /// <summary>
    /// Whether user is a guest (not authenticated)
    /// </summary>
    [Parameter]
    public bool IsGuest { get; set; } = true;

    /// <summary>
    /// Whether save is in progress
    /// </summary>
    [Parameter]
    public bool IsSaving { get; set; }

    /// <summary>
    /// Whether there are unsaved changes
    /// </summary>
    [Parameter]
    public bool HasUnsavedChanges { get; set; }

    /// <summary>
    /// Whether compare is available (requires saved scenarios)
    /// </summary>
    [Parameter]
    public bool CanCompare { get; set; }

    /// <summary>
    /// Show reset button
    /// </summary>
    [Parameter]
    public bool ShowReset { get; set; } = true;

    /// <summary>
    /// Show help button
    /// </summary>
    [Parameter]
    public bool ShowHelp { get; set; } = true;

    /// <summary>
    /// Callbacks
    /// </summary>
    [Parameter] public EventCallback OnReset { get; set; }
    [Parameter] public EventCallback OnHelp { get; set; }
    [Parameter] public EventCallback OnSave { get; set; }
    [Parameter] public EventCallback OnExport { get; set; }
    [Parameter] public EventCallback OnCompare { get; set; }
    [Parameter] public EventCallback OnSignUp { get; set; }

    private async Task HandleReset() => await OnReset.InvokeAsync();
    private async Task HandleHelp() => await OnHelp.InvokeAsync();
    private async Task HandleSave() => await OnSave.InvokeAsync();
    private async Task HandleExport() => await OnExport.InvokeAsync();
    private async Task HandleCompare() => await OnCompare.InvokeAsync();
    private async Task HandleSignUp() => await OnSignUp.InvokeAsync();
}
