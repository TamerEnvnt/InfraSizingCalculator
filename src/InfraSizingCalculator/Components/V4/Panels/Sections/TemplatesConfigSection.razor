@*
    TemplatesConfigSection.razor - v0.4.4 VM Templates Configuration
    VM-specific configuration for VM sizing templates per role
*@

<div class="config-section" data-testid="templates-config">
    <div class="form-group">
        <label class="form-label">Sizing Approach</label>
        <div class="toggle-group">
            <button class="toggle-btn @(_sizingMode == "template" ? "active" : "")"
                    @onclick="@(() => SetSizingMode("template"))">Templates</button>
            <button class="toggle-btn @(_sizingMode == "custom" ? "active" : "")"
                    @onclick="@(() => SetSizingMode("custom"))">Custom</button>
        </div>
    </div>

    @if (_sizingMode == "template")
    {
        <div class="form-group">
            <label class="form-label">Template Size</label>
            <select class="form-select" @bind="_templateSize" @bind:after="NotifyChange">
                <option value="small">Small (Dev/Test)</option>
                <option value="medium">Medium (Staging)</option>
                <option value="large">Large (Production)</option>
                <option value="xlarge">X-Large (High Performance)</option>
            </select>
        </div>

        <div class="info-box">
            <strong>@GetTemplateName() Specifications</strong>
            <table class="spec-table">
                <thead>
                    <tr><th>Role</th><th>vCPU</th><th>RAM</th><th>Disk</th></tr>
                </thead>
                <tbody>
                    @foreach (var spec in GetTemplateSpecs())
                    {
                        <tr>
                            <td>@spec.Role</td>
                            <td>@spec.Vcpu</td>
                            <td>@spec.Ram</td>
                            <td>@spec.Disk</td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    }
    else
    {
        <div class="divider"></div>

        <!-- App Server Template -->
        <div class="template-section">
            <div class="template-header">App Server</div>
            <div class="spec-row">
                <div class="spec-item">
                    <span class="spec-label">vCPU</span>
                    <select class="form-select-sm" @bind="_appVcpu" @bind:after="NotifyChange">
                        <option value="2">2</option>
                        <option value="4">4</option>
                        <option value="8">8</option>
                        <option value="16">16</option>
                    </select>
                </div>
                <div class="spec-item">
                    <span class="spec-label">RAM</span>
                    <select class="form-select-sm" @bind="_appRam" @bind:after="NotifyChange">
                        <option value="8">8 GB</option>
                        <option value="16">16 GB</option>
                        <option value="32">32 GB</option>
                        <option value="64">64 GB</option>
                    </select>
                </div>
                <div class="spec-item">
                    <span class="spec-label">Disk</span>
                    <select class="form-select-sm" @bind="_appDisk" @bind:after="NotifyChange">
                        <option value="60">60 GB</option>
                        <option value="120">120 GB</option>
                        <option value="250">250 GB</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Database Server Template -->
        <div class="template-section">
            <div class="template-header">Database Server</div>
            <div class="spec-row">
                <div class="spec-item">
                    <span class="spec-label">vCPU</span>
                    <select class="form-select-sm" @bind="_dbVcpu" @bind:after="NotifyChange">
                        <option value="4">4</option>
                        <option value="8">8</option>
                        <option value="16">16</option>
                        <option value="32">32</option>
                    </select>
                </div>
                <div class="spec-item">
                    <span class="spec-label">RAM</span>
                    <select class="form-select-sm" @bind="_dbRam" @bind:after="NotifyChange">
                        <option value="32">32 GB</option>
                        <option value="64">64 GB</option>
                        <option value="128">128 GB</option>
                        <option value="256">256 GB</option>
                    </select>
                </div>
                <div class="spec-item">
                    <span class="spec-label">Disk</span>
                    <select class="form-select-sm" @bind="_dbDisk" @bind:after="NotifyChange">
                        <option value="250">250 GB</option>
                        <option value="500">500 GB</option>
                        <option value="1000">1 TB</option>
                        <option value="2000">2 TB</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Web Server Template -->
        <div class="template-section">
            <div class="template-header">Web Server</div>
            <div class="spec-row">
                <div class="spec-item">
                    <span class="spec-label">vCPU</span>
                    <select class="form-select-sm" @bind="_webVcpu" @bind:after="NotifyChange">
                        <option value="2">2</option>
                        <option value="4">4</option>
                        <option value="8">8</option>
                    </select>
                </div>
                <div class="spec-item">
                    <span class="spec-label">RAM</span>
                    <select class="form-select-sm" @bind="_webRam" @bind:after="NotifyChange">
                        <option value="4">4 GB</option>
                        <option value="8">8 GB</option>
                        <option value="16">16 GB</option>
                    </select>
                </div>
                <div class="spec-item">
                    <span class="spec-label">Disk</span>
                    <select class="form-select-sm" @bind="_webDisk" @bind:after="NotifyChange">
                        <option value="40">40 GB</option>
                        <option value="60">60 GB</option>
                        <option value="120">120 GB</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Utility Server Template -->
        <div class="template-section">
            <div class="template-header">Utility Server</div>
            <div class="spec-row">
                <div class="spec-item">
                    <span class="spec-label">vCPU</span>
                    <select class="form-select-sm" @bind="_utilVcpu" @bind:after="NotifyChange">
                        <option value="2">2</option>
                        <option value="4">4</option>
                    </select>
                </div>
                <div class="spec-item">
                    <span class="spec-label">RAM</span>
                    <select class="form-select-sm" @bind="_utilRam" @bind:after="NotifyChange">
                        <option value="4">4 GB</option>
                        <option value="8">8 GB</option>
                    </select>
                </div>
                <div class="spec-item">
                    <span class="spec-label">Disk</span>
                    <select class="form-select-sm" @bind="_utilDisk" @bind:after="NotifyChange">
                        <option value="40">40 GB</option>
                        <option value="60">60 GB</option>
                    </select>
                </div>
            </div>
        </div>
    }
</div>

<style>
    .template-section {
        margin-bottom: 12px;
        padding-bottom: 12px;
        border-bottom: 1px solid var(--color-border, #e2e8f0);
    }
    .template-section:last-child {
        border-bottom: none;
        margin-bottom: 0;
        padding-bottom: 0;
    }
    .template-header {
        font-size: 11px;
        font-weight: 600;
        color: var(--color-text, #1e293b);
        margin-bottom: 8px;
    }
    .spec-table {
        width: 100%;
        font-size: 10px;
        border-collapse: collapse;
        margin-top: 8px;
    }
    .spec-table th {
        text-align: left;
        color: var(--color-text-secondary, #64748b);
        font-weight: 600;
        padding: 4px 6px;
        border-bottom: 1px solid var(--color-border, #e2e8f0);
    }
    .spec-table td {
        padding: 4px 6px;
        color: var(--color-text, #1e293b);
    }
</style>

@code {
    [Parameter]
    public EventCallback OnConfigChange { get; set; }

    private string _sizingMode = "template";
    private string _templateSize = "large";

    // Custom specs
    private int _appVcpu = 4, _appRam = 16, _appDisk = 120;
    private int _dbVcpu = 8, _dbRam = 64, _dbDisk = 500;
    private int _webVcpu = 2, _webRam = 8, _webDisk = 60;
    private int _utilVcpu = 2, _utilRam = 4, _utilDisk = 60;

    private async Task SetSizingMode(string mode)
    {
        _sizingMode = mode;
        await NotifyChange();
    }

    private async Task NotifyChange()
    {
        await OnConfigChange.InvokeAsync();
    }

    private string GetTemplateName() => _templateSize switch
    {
        "small" => "Small (Dev/Test)",
        "medium" => "Medium (Staging)",
        "large" => "Large (Production)",
        "xlarge" => "X-Large (High Performance)",
        _ => "Unknown"
    };

    private List<TemplateSpec> GetTemplateSpecs() => _templateSize switch
    {
        "small" => new()
        {
            new("App Server", 2, "4 GB", "60 GB"),
            new("Database", 2, "8 GB", "100 GB"),
            new("Web Server", 1, "2 GB", "40 GB"),
            new("Utility", 1, "2 GB", "40 GB")
        },
        "medium" => new()
        {
            new("App Server", 2, "8 GB", "80 GB"),
            new("Database", 4, "32 GB", "250 GB"),
            new("Web Server", 2, "4 GB", "40 GB"),
            new("Utility", 2, "4 GB", "60 GB")
        },
        "large" => new()
        {
            new("App Server", 4, "16 GB", "120 GB"),
            new("Database", 8, "64 GB", "500 GB"),
            new("Web Server", 2, "8 GB", "60 GB"),
            new("Utility", 2, "4 GB", "60 GB")
        },
        "xlarge" => new()
        {
            new("App Server", 8, "32 GB", "250 GB"),
            new("Database", 16, "128 GB", "1 TB"),
            new("Web Server", 4, "16 GB", "120 GB"),
            new("Utility", 4, "8 GB", "120 GB")
        },
        _ => new()
    };

    public record TemplateSpec(string Role, int Vcpu, string Ram, string Disk);
}
